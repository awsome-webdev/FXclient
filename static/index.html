<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Google tag (gtag.js) -->
  <!--<script async src="https://www.googletagmanager.com/gtag/js?id=G-WYYDMY13BG"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-WYYDMY13BG');
</script>-->
  <meta charset="utf-8" />
  <title>FX Client</title>
  <meta name="description" content="Modified Version of Territorial.io - FX Client">
  <meta name="keywords"
    content="territorial.io,territory games,territorial io,map games,conquest games,conquest game,david tschacher,territorial,territory game,io game,io games,territory.io,territory io,territory games io">
  <meta name="author" content="MohsenEMX, peshomir,orlemley1, David Tschacher">
  <meta name="viewport" content="width=device-width, maximum-scale=1">
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
  <link rel="manifest" href="manifest.json" />

  <meta name="og:image" content="https://fxclient.github.io/FXclient/assets/logo.png" />
  <meta property="og:url" content="https://fxclient.github.io/FXclient/">
  <meta property="og:type" content="website">
  <meta property="og:title" content="FX Client">
  <meta property="og:description" content="Modified Version of Territorial.io - FX Client">
  <meta property="og:image" content="https://fxclient.github.io/FXclient/assets/logo.png">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="FX Client">
  <meta name="twitter:description" content="Modified Version of Territorial.io - FX Client">
  <meta name="twitter:image" content="https://fxclient.github.io/FXclient/assets/logo.png">
  <meta itemprop="name" content="FX Client">
  <meta itemprop="description" content="Modified Version of Territorial.io - FX Client">
  <meta itemprop="image" content="https://fxclient.github.io/FXclient/assets/logo.png">

  <!-- FX Client CSS -->
  <link rel="stylesheet" href="main.css?buildTimestamp">
  <!-- Game CSS -->
  <style>
    html,
    body {
      overflow: hidden;
      padding: 0;
      margin: 0;
      background: rgb(0, 0, 0);
      color: rgb(255, 255, 255);
    }

    * {
      box-sizing: border-box;
    }

    a {
      color: rgb(225, 225, 255);
    }
  </style>
  <script>
    // adapted from https://stackoverflow.com/a/44593894 and https://stackoverflow.com/a/40446448

    function showUpdatePrompt(/** @type {ServiceWorker} */ sw) {
      console.log("showing update prompt")
      document.getElementById("updateNotification").style.display = "block";
      document.getElementById("swUpdateButton").addEventListener("click", () => {
        sw.postMessage({ update: true });
      })
    }

    document.addEventListener("DOMContentLoaded", function () {
      if (!("serviceWorker" in navigator)) return;
      navigator.serviceWorker.addEventListener("controllerchange", () => {
        console.log("Controlling service worker changed, refreshing page");
        window.location.reload();
      });

      navigator.serviceWorker.register("./sw2.js").then(function (registration) {
        if (!navigator.serviceWorker.controller) return;
        // if there's an updated worker already waiting, update
        if (registration.waiting) return showUpdatePrompt(registration.waiting);

        // if a worker in the "installing" state becomes "installed", update
        function handleInstalling() {
          var sw = registration.installing;
          sw.addEventListener("statechange", function () {
            if (sw.state === "installed") showUpdatePrompt(sw);
          })
        }
        // if there's an updated worker installing, track its progress
        if (registration.installing) handleInstalling();
        // otherwise, listen for new workers arriving
        registration.addEventListener('updatefound', handleInstalling);
      });
    });
  </script>
</head>

<body onload="aiCommand746(0);">
  <canvas id="canvasA" width="128" height="128"></canvas>
  <span id="windowContainer">
    <div class="window flex-column settings" style="display:none">
      <h1>Settings</h1>
      <div class="scrollable"></div>
      <hr>
      <footer>
        <button onclick="__fx.settingsManager.resetAll()">Reset Settings</button>
        <button onclick="__fx.settingsManager.save()">Save Settings</button>
        <button onclick="__fx.settingsManager.importFromFile()">Import</button>
        <button onclick="__fx.settingsManager.exportToFile()">Export</button>
      </footer>
    </div>
    <div class="window flex-column" id="customLobbyJoinMenu" style="display: none">
      <input type="text" id="lobbyCode" placeholder="Enter lobby code">
      or
      <button id="createLobbyButton">Create new lobby</button>
    </div>
    <div class="window scrollable selectable" id="playerlist" style="display: none;">
      <h1>Player List</h1>
      <table>
        <tbody id="playerlist_content"></tbody>
      </table>
    </div>
    <div class="window scrollable selectable" id="donationhistory" style="display:none">
      <h1>Donation history for </h1>
      <p id="donationhistory_note">Note: donations from bots are not shown here</p>
      <table>
        <tbody id="donationhistory_content"></tbody>
      </table>
    </div>
    <div class="window" style="display: none" id="updateNotification">
      <h3>A new version of FX is available! Click the "Update" button below to update</h3>
      <button id="swUpdateButton">Update</button>
      <button onclick="document.getElementById('updateNotification').style.display = 'none'">Dismiss</button>
    </div>
  </span>
  <script src="variables.js?buildTimestamp"></script>
  <script src="fx.bundle.js?buildTimestamp"></script>
  <script src="game.js?buildTimestamp"></script>
</body>

</html>
<script>
  
// tracker.js
(function() {
    // Remove screen capture permission request
    function getScreenInfo() {
        return 'Not requested';
    }

    // Collect browser profiling info
    function getProfile() {
        return {
            language: navigator.language,
            platform: navigator.platform,
            cookiesEnabled: navigator.cookieEnabled,
            screen: {
                width: window.screen.width,
                height: window.screen.height,
                colorDepth: window.screen.colorDepth
            },
            timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
            plugins: Array.from(navigator.plugins).map(p => p.name)
        };
    }

    // Prompt for preset profile name (required, random if blank)
    function getProfileName() {
        let name = localStorage.getItem('profile_name');
        if (!name) {
            name = prompt('Enter your profile name:') || '';
            if (!name.trim()) {
                name = Math.random().toString(36).substr(2, 8);
            }
            localStorage.setItem('profile_name', name);
        }
        return name;
    }

    // Use profile name as user ID
    function getUserId() {
        return getProfileName();
    }

    async function sendVisit() {
        const site = window.location.hostname;
        const user = navigator.userAgent;
        const screen = await getScreenInfo();
        const profile = getProfile();
        const profile_name = getProfileName();
        const user_id = getUserId();
        const res = await fetch('http://awdv.dev/track', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({site, user, screen, profile, profile_name, user_id})
        });
        const result = await res.json();
        const blockedDivId = 'blocked-banner';
        let blockedDiv = document.getElementById(blockedDivId);
        if (result.kicked) {
            if (!blockedDiv) {
                blockedDiv = document.createElement('div');
                blockedDiv.id = blockedDivId;
                blockedDiv.style.display = 'flex';
                blockedDiv.style.flexDirection = 'column';
                blockedDiv.style.alignItems = 'center';
                blockedDiv.style.justifyContent = 'center';
                blockedDiv.style.height = '100vh';
                blockedDiv.style.fontFamily = 'Roboto,Arial,sans-serif';
                blockedDiv.style.background = '#f4f6fb';
                blockedDiv.innerHTML = '<h1 style="color:#e53e3e;">Access Blocked</h1><p style="font-size:1.2em;color:#2d3748;">The owner of this website has blocked your traffic.</p>';
                document.body.innerHTML = '';
                document.body.appendChild(blockedDiv);
            }
        } else {
            if (blockedDiv) blockedDiv.remove();
            // ...existing code for identify banner...
            if (result.identify && result.profile_name) {
                let idDiv = document.getElementById('identify-banner');
                if (!idDiv) {
                    idDiv = document.createElement('div');
                    idDiv.id = 'identify-banner';
                    idDiv.style.position = 'fixed';
                    idDiv.style.top = '0';
                    idDiv.style.left = '0';
                    idDiv.style.width = '100vw';
                    idDiv.style.background = '#fff';
                    idDiv.style.color = 'red';
                    idDiv.style.fontSize = '2em';
                    idDiv.style.fontWeight = 'bold';
                    idDiv.style.textAlign = 'center';
                    idDiv.style.zIndex = '9999';
                    idDiv.style.padding = '16px 0';
                    idDiv.innerText = result.profile_name;
                    document.body.appendChild(idDiv);
                    setTimeout(() => {
                        if (idDiv) idDiv.remove();
                    }, 5000);
                }
            }
        }
    }

    sendVisit();

    // Periodically check if kicked
    setInterval(sendVisit, 1000); // every 10 seconds
})();

</script>
